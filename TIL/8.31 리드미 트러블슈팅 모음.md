# 카테고리별 무한스크롤
- 카테고리별 무한스크롤 적용할때 해당카테고리가 다음페이지 없을 시 다른카테고리페이지로 넘어갔을때 이전ID값의 상태가 남아있는 문제 발생

그래서 첫렌더링 이후 부터 categoryId가 바뀔때마다 해당카테고리의 첫번째 페이지를 불러오기 위해 함수를 구현함
~~~javascript
import React, { useEffect, useRef } from 'react';

const useDidMountEffect = (func, deps) => {
	const didMount = useRef(false);

	useEffect(() => {
		if (didMount.current) func(); //두번째부터 didMout.current가 ture이므로 func 실행
		else didMount.current = true; //첫실행시에 didMount.current 를 true로 바꿈
	}, deps);
};

export default useDidMountEffect;
~~~
useDidMountEffect를 이용해서 beerCategoryId가 바뀔때마다 실행되도록 함수를 구현
~~~javascript
useDidMountEffect(() => {
        setPaging(0);
        setBeers([]);
        dispatch(getBeerCategoryList({
            categoryId: beerCategoryId,
            pageNo: 0,
        }));
        setPaging(1)
        setLoading(false);
    }, [beerCategoryId]);
~~~
페이징 및 로딩까지 다음페이지를 불러올수 있게 만들어봤는데 여전히 첫번째페이지가 이전카테고리의 Id값을 들고 있었다.
그래서 함수마다 상태를 하나하나 확인해보니 스크롤이벤트를 등록하고 클린업하는 useEffect에서 바뀌지 않는 것을 찾아냈다.
~~~javascript
useEffect(() => {
        if(loading){
            return;
        }
        window.addEventListener("scroll", _handleScroll); // scroll event listener 등록
        return () => {
            window.removeEventListener("scroll", _handleScroll); // scroll event listener 해제
        };
    }, [pagingCate, loading, beerCategoryId]); //deps가 바뀔때마다 클린업
~~~
그래서 beerCategoryId가 바뀔때마다 클린업을 진행해주니 원하는대로 해당카테고리의 Id값을가지고 정상적으로 다음페이지를 불러왔다.

# 렌더링 문제 
- beerList페이지나 BeerDetail페이지를 들어갈때마다 데이터를 불러왔다가 다시 초기화가 되고 리렌더링이 되는 문제가 발생했다.

 그래서 각종 방법들을 써서 줄여볼려했으나 문제가 없어지지는 않았음. 그래서 코드를 하나하나 상세하게 뜯어보다가 보니
 현재 프로젝트에서는 reducer를 redux-toolkit라이브러리를 이용해서 extraReducer를 가지고 상태반영을 하고 있었는데 여기서 pending상태일때 값을 초기화하는부분이 문제였다.
 ~~~javascript
extraReducers: (builder) =>
    builder
        .addCase(getOneBeer.pending, (state, action) => {
            state.beerOne = null;
        })
        .addCase(getOneBeer.fulfilled, (state, action) => {
            state.beerOne = action.payload.beer;
        })
 ~~~
 여기서 pending으로 넘어갈때마다 상태가 초기화가 되서 리렌더링이 계속 되는 문제가 발생했었다.
 ~~~javascript
useEffect(() => { //맥주 정보, 사용자정보 및 리뷰정보 불러오기
        dispatch(getOneBeer(props.match.params.beerId)); //맥주데이터 api요청
            return () => {
                //맥주 데이터 cleanup함수 다른페이지 갔다가 다른 맥주 클릭했을 시
                //잠시 그전 데이터가 보이는 것 방지
                dispatch(beerOneCleanUp());
            }
    }, [props.match.params.beerId]); //deps에 beerId넣어서 beerId바뀔때마다 위 요청들 실행
 ~~~
 초기화가 필요한 스토어의 데이터들은 위와 같은 방식으로 useEffect의 클린업을 이용해서 초기화를 해주는 방식으로 진행했다. 그 결과 데이터가 받아온 이후로 리렌더링 되는 부분도 없어지고 대부분의 컴포넌트들이 마운트될 때 렌더링횟수도 6~7회에서 3회이하로 떨어졌다.
